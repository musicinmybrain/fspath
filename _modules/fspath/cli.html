
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>fspath.cli &#8212; FSPath 20190323 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/custom.css" />
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/sphinx_highlight.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">FSPath 20190323 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" accesskey="U">Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">fspath.cli</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for fspath.cli</h1><div class="highlight"><pre>
<span></span>#!/usr/bin/env python
# -*- coding: utf-8; mode: python -*-
# pylint: disable=invalid-name

u&quot;&quot;&quot;
A command line interface made simple.
&quot;&quot;&quot;

# ==============================================================================
# imports
# ==============================================================================

import os
import textwrap
import sys
import argparse
import inspect
import code
import linecache

from . import compat
from .os_env import OS_ENV

VERBOSE = False
DEBUG   = bool(OS_ENV.get(&quot;DEBUG&quot;, False))
QUIET   = False


<div class="viewcode-block" id="HelpFormatter"><a class="viewcode-back" href="../../fspath-api/fspath.cli.html#fspath.cli.HelpFormatter">[docs]</a>class HelpFormatter(argparse.HelpFormatter):
    &quot;&quot;&quot;
    Help message formatter which adds default values to argument help.

    Any formatting in description retains.
    &quot;&quot;&quot;
    # pylint: disable=redefined-builtin

    def _fill_text(self, text, width, indent):

        text.expandtabs()
        lines = text.splitlines()

        # doc-strings often have no indentation in the first line.

        first = lines[0]
        if first.strip():
            if len(first) - len(first.lstrip(&#39; &#39;)) == 0:
                lines[0] = &#39;    &#39; + first

        text = textwrap.dedent(&quot;\n&quot;.join(lines))
        text = compat.indent(text, indent)
        #text = textwrap.fill(text, width = width)
        return text

    def _get_help_string(self, action):
        help = action.help
        if &#39;%(default)&#39; not in action.help:
            if action.default is not argparse.SUPPRESS:
                defaulting_nargs = [argparse.OPTIONAL, argparse.ZERO_OR_MORE]
                if action.option_strings or action.nargs in defaulting_nargs:
                    help += &#39; (default: %(default)s)&#39;
        return help</div>

<div class="viewcode-block" id="CLIApplError"><a class="viewcode-back" href="../../fspath-api/fspath.cli.html#fspath.cli.CLIApplError">[docs]</a>class CLIApplError(Exception):
    &quot;&quot;&quot;Exception raised for errors in the application&quot;&quot;&quot;
    # pylint: disable=super-init-not-called
    def __init__(self, exitCode, message):
        self.exitCode = exitCode
        self.message = message</div>

# ==============================================================================
<div class="viewcode-block" id="CLI"><a class="viewcode-back" href="../../fspath-api/fspath.cli.html#fspath.cli.CLI">[docs]</a>class CLI(object):
# ==============================================================================

    u&quot;&quot;&quot;A comfortable command line.&quot;&quot;&quot;

    OUT = sys.__stdout__
    ERR = sys.__stderr__

    def __init__(self, *args, **kwargs):

        kwargs[&quot;formatter_class&quot;] = HelpFormatter

        self.cmdFunc       = kwargs.pop(&quot;cmdFunc&quot;, None)
        self.cliSubParsers = None

        if self.cmdFunc is not None:
            kwargs[&quot;epilog&quot;] = kwargs.get(&quot;epilog&quot;, self.cmdFunc.__doc__)
            kwargs[&quot;description&quot;] = kwargs.get(
                &quot;description&quot;
                , kwargs[&quot;epilog&quot;].strip().split(&quot;\n&quot;)[0] if kwargs[&quot;epilog&quot;] else None)

        self.parser = argparse.ArgumentParser(*args, **kwargs)

        if self.cmdFunc is None:
            self.cliSubParsers = self.parser.add_subparsers(title=&#39;commands&#39;, dest=&#39;command&#39;)
            self.cliSubParsers.required = True

        self.add_argument  = self.parser.add_argument
        self.add_argument(
            &#39;--debug&#39;
            , action  = &#39;store_true&#39;
            , help    = &#39;run in debug mode&#39; )

        self.add_argument(
            &#39;--verbose&#39;
            , action  = &#39;store_true&#39;
            , help    = &#39;run in verbose mode&#39; )

        self.add_argument(
            &#39;--quiet&#39;
            , action  = &#39;store_true&#39;
            , help    = &#39;run in quiet mode&#39; )

<div class="viewcode-block" id="CLI.addCMDParser"><a class="viewcode-back" href="../../fspath-api/fspath.cli.html#fspath.cli.CLI.addCMDParser">[docs]</a>    def addCMDParser(self, func, cmdName=None):
        &quot;&quot;&quot;Add subcommand parser&quot;&quot;&quot;

        if self.cliSubParsers is None:
            raise Exception(&quot;this command-line has no sub-commands!&quot;)

        subCmd = self.cliSubParsers.add_parser(
            cmdName or func.__name__
            , epilog          = func.__doc__
            , formatter_class = HelpFormatter
            , help            = ((func.__doc__ or &quot;&quot;).strip().split(&quot;\n&quot;) + [ &quot;sorry, no help available&quot; ])[0]
        )
        subCmd.set_defaults(func=func)
        return subCmd</div>

    def __call__(self):

        _exitCode  = 0
        _exception = None
        _retVal    = None

        self.autocomplete()

        cmd_args = self.parser.parse_args()
        cmd_args.CLI = self
        cmd_args.OUT = self.OUT
        cmd_args.ERR = self.ERR
        cmd_args.Error = CLIApplError

        if OS_ENV.get(&quot;DEBUG&quot;, None):
            cmd_args.debug = True

        # pylint: disable=W0603
        global DEBUG, VERBOSE, QUIET
        DEBUG   = cmd_args.debug
        VERBOSE = cmd_args.verbose
        QUIET   = cmd_args.quiet

        if DEBUG:
            self.OUT.write(u&quot;argparse --&gt; %s\n&quot; % cmd_args)
            __builtins__[&quot;CONSOLE&quot;] = CONSOLE

        try:
            if self.cmdFunc is None:
                _retVal = cmd_args.func(cmd_args)
            else:
                _retVal = self.cmdFunc(cmd_args)
            try:
                if _retVal is None:
                    _exitCode = 0
                else:
                    _exitCode = int(_retVal)
            except Exception as exc: # pylint: disable=W0703
                pass

        except CLIApplError as exc: # pylint: disable=W0703
            _exitCode  = exc.exitCode
            self.ERR.write(u&quot;ERROR (%s): %s\n&quot; % (exc.exitCode, exc.message))

        except Exception as exc: # pylint: disable=W0703
            if cmd_args.debug:
                raise
            _exitCode  = 42
            _exception = str(exc)
            sys.stderr.write(u&quot;FATAL ERROR: %s\n&quot; % _exception)
        sys.exit(_exitCode)

<div class="viewcode-block" id="CLI.autocomplete"><a class="viewcode-back" href="../../fspath-api/fspath.cli.html#fspath.cli.CLI.autocomplete">[docs]</a>    def autocomplete(self):
        u&quot;&quot;&quot;bash completion

        To get in use of bash completion, install ``argcomplete``:

        .. code-block:: bash

           pip install argcomplete

        and add the following to your ~/.bashrc:

        .. code-block:: bash

           function _py_argcomplete() {
                   local IFS=$(echo -e &#39;\\v&#39;)
                   COMPREPLY=( $(IFS=&quot;$IFS&quot; \\
                           COMP_LINE=&quot;$COMP_LINE&quot; \\
                           COMP_POINT=&quot;$COMP_POINT&quot; \\
                           _ARGCOMPLETE_COMP_WORDBREAKS=&quot;$COMP_WORDBREAKS&quot; \\
                           _ARGCOMPLETE=1 \\
                           &quot;$1&quot; 8&gt;&amp;1 9&gt;&amp;2 1&gt;/dev/null) )
                   if [[ $? != 0 ]]; then
                           unset COMPREPLY
                   fi
           }
           complete -o nospace -o default -F _py_argcomplete myCommandName

        ..
        &quot;&quot;&quot;

        # only complete when called from _py_argcomplete()
        if &#39;_ARGCOMPLETE&#39; not in os.environ:
            return
        try:
            import argcomplete  # pylint: disable=import-error
        except ImportError:
            self.ERR.write(&quot;TAB-completion, python-argcomplete not installed.&quot;)
            sys.exit(1)
        argcomplete.autocomplete(self.parser)</div></div>


<div class="viewcode-block" id="CONSOLE"><a class="viewcode-back" href="../../fspath-api/fspath.cli.html#fspath.cli.CONSOLE">[docs]</a>def CONSOLE(arround=5, frame=None):
    u&quot;&quot;&quot;
    2cent debugging &amp; introspection
    &quot;&quot;&quot;
    # pylint: disable=C0321,C0410

    sys.stderr.flush()
    sys.stdout.flush()

    frame  = frame or inspect.currentframe().f_back
    fName  = frame.f_code.co_filename
    lineNo = frame.f_lineno

    ns = dict(**frame.f_globals)
    ns.update(**frame.f_locals)

    histfile = os.path.join(os.path.expanduser(&quot;~&quot;), &quot;.kernel-doc-history&quot;)
    try:
        import readline, rlcompleter  # pylint: disable=W0612
        readline.set_completer(rlcompleter.Completer(namespace=ns).complete)
        readline.parse_and_bind(&quot;tab: complete&quot;)
        readline.set_history_length(1000)
        if os.path.exists(histfile):
            readline.read_history_file(histfile)
    except ImportError:
        readline = None
    lines  = []
    for c in range(lineNo - arround, lineNo + arround):
        if c &gt; 0:
            prefix = &quot;%-04s|&quot; % c
            if c == lineNo:   prefix = &quot;----&gt;&quot;
            line = linecache.getline(fName, c, frame.f_globals)
            if line != &#39;&#39;:    lines.append(prefix + line)
            else:
                if lines: lines[-1] = lines[-1] + &quot;&lt;EOF&gt;\n&quot;
                break
    banner =  &quot;&quot;.join(lines) + &quot;file: %s:%s\n&quot; % (fName, lineNo)
    try:
        code.interact(banner=banner, local=ns)
    finally:
        if readline is not None:
            readline.write_history_file(histfile)</div>

<div class="viewcode-block" id="DUMMY_CONSOLE"><a class="viewcode-back" href="../../fspath-api/fspath.cli.html#fspath.cli.DUMMY_CONSOLE">[docs]</a>def DUMMY_CONSOLE(*_x, **_y):
    u&quot;&quot;&quot;A dummy console, spid out warnings for usage of &#39;CONSOLE&#39; without activated DEBUG
    environment.
    &quot;&quot;&quot;
    frame  = inspect.currentframe().f_back
    fName  = frame.f_code.co_filename
    lineNo = frame.f_lineno
    sys.stderr.write(&quot;%s:%s: [WARNING] usage of CONSOLE / debug not activated!\n&quot; % (fName, lineNo))</div>

__builtins__[&quot;CONSOLE&quot;] = DUMMY_CONSOLE
if DEBUG:
    __builtins__[&quot;CONSOLE&quot;] = CONSOLE

</pre></div>

            <div class="clearer"></div>
          </div>
        </div>
      </div>
  <span id="sidebar-top"></span>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  
    
            <p class="logo"><a href="../../index.html">
              <img class="logo" src="../../_static/darmarIT_logo_128.png" alt="Logo"/>
            </a></p>
  
<h3>Navigation</h3>
<ul>
  <li><a href="../../index.html">Overview</a>
    <ul>
      <li><a href="../index.html">Module code</a>
        
          
          </ul>
      </li>
    </ul>
  </li>
</ul>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script><div id="ethical-ad-placement"></div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
  
    <div class="footer" role="contentinfo">
        &#169; Copyright 2023 Markus Heiser.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 6.1.3.
    </div>
  <script src="../../_static/version_warning_offset.js"></script>

  </body>
</html>